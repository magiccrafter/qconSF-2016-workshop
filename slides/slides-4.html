<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=" http-equiv="Content-Type" />
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
<meta content="Asciidoctor 1.5.3" name="generator" />
<title>Core Java: Object Mapping &amp; Annotations</title>
<link href="deck.js/themes/style/font.css" rel="stylesheet" />
<style>
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 1.2em; height: 1.2em; font-size: 0.9em; font-weight: bold; line-height: 1.2; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -0.1em; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.colist table td:first-of-type { padding-right: 0.25em; }
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<link href="deck.js/core/deck.core.css" rel="stylesheet" />
<link href="deck.js/extensions/scale/deck.scale.css" media="screen" rel="stylesheet" />
<link href="deck.js/extensions/goto/deck.goto.css" media="screen" rel="stylesheet" />
<link href="deck.js/themes/style/datastax.css" media="screen" rel="stylesheet" />
<link href="deck.js/themes/transition/fade.css" media="screen" rel="stylesheet" />
<link href="deck.js/core/print.css" media="print" rel="stylesheet" />
<script src="deck.js/modernizr.custom.js"></script>
</head>
<body class="article">
<div class="deck-container">
<section class="slide" id="title-slide">
<h1>Core Java: Object Mapping &amp; Annotations</h1>
</section>
<section class="slide transition-blue" id="courses-DS420-components-sections-java-driver-object-mapping-modeling-review">
<h2>Core Java - Part 3 - Object Mapping &amp; Annotations</h2>

</section>
<section class="slide transition-green" id="modeling-review">
<h2>Modeling Review</h2>

</section>
<section class="slide" id="data-model-review">
<h2>Data Model Review</h2>
<div class="paragraph"><p>Before we get into Mapping Objects first want to do a quick review of a piece of Data Modeling</p></div>
<div class="ulist">
<ul>
<li>The examples should look familiar</li>
<li>From our Data Modeling course featuring killrvideo</li>
<li>Think about how the model effects your Mapping</li>
<li>Our next exercise will have you do a like model for Addresses</li>
</ul>
</div>
<div class="ulist notes">
<ul>
<li>Slide mainly here to transition and explain whey we have video stuff</li>
<li>Think we want to reuse material, but maybe instead we redo?</li>
</ul>
</div>
</section>
<section class="slide transition-green" id="courses-DS420-components-sections-java-driver-object-mapping-modeling-relationships">
<h2>Modeling Relationships</h2>

</section>
<section class="slide" id="modeling-1-n-relationships">
<h2>Modeling 1-n Relationships</h2>
<div class="ulist">
<ul>
<li>Good data model strives for <em>single partition</em> queries.</li>
<li>Nesting child entities in parent entities helps achieve this.</li>
<li>Review: What is the key of this relationship?</li>
<li>How could we model this relationship as CQL tables?</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img alt="user video model" src="images/courses/DS420/components/sections/java-driver-object-mapping/modeling-relationships/user-video-model.svg" width="150%" />
</div>
</div>
<div class="openblock notes">
<div class="content">
<div class="paragraph"><p>The key is <code>video_id</code> as it will be unique for every instance of the relationship. See DS220 for details.</p></div>
</div>
</div>
</section>
<section class="slide" id="1-n-relationships-take-1">
<h2>1-n Relationships Take #1</h2>
<div class="paragraph"><p>Model as two tables:</p></div>
<div class="imageblock">
<div class="content">
<img alt="user video emodel2" src="images/courses/DS420/components/sections/java-driver-object-mapping/modeling-relationships/user-video-emodel2.svg" />
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Results in a <em>Client Side</em> join
</td>
</tr>
</table>
</div>
</section>
<section class="slide" id="1-n-relationships-take-2">
<h2>1-n Relationships Take #2</h2>
<div class="paragraph"><p>Nest  using static columns.</p></div>
<div class="imageblock">
<div class="content">
<img alt="videos by user" src="images/courses/DS420/components/sections/java-driver-object-mapping/modeling-relationships/videos_by_user.svg" />
</div>
</div>
<div class="paragraph"><p>Results in a <em>single partition</em> query&#8230;&#8203;but is this table about users or videos (hmmm)?</p></div>
</section>
<section class="slide" id="1-n-relationships-take-3">
<h2>1-n Relationships Take #3</h2>
<div class="paragraph"><p>Nest <code>videos</code> using collections and UDT</p></div>
<div class="imageblock">
<div class="content">
<img alt="users nested videos" src="images/courses/DS420/components/sections/java-driver-object-mapping/modeling-relationships/users_nested_videos.svg" />
</div>
</div>
<div class="paragraph"><p>Results in a <em>Single Partition</em> query</p></div>
</section>
<section class="slide transition-green" id="courses-DS420-components-sections-java-driver-object-mapping-nesting-udts">
<h2>Nesting User Defined Types</h2>

</section>
<section class="slide" id="implementing-take-3">
<h2>Implementing Take #3</h2>
<div class="ulist">
<ul>
<li>Create a UDT</li>
<li>Add a collection to <em>user</em> table</li>
<li>Mutate the collection</li>
<li>Map a POJO to the <em>UDTValue</em></li>
<li>Access collection from the Java Driver</li>
</ul>
</div>
</section>
<section class="slide" id="create-a-udt">
<h2>Create a UDT</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="sql language-sql"><span class="class">CREATE</span> TYPE video (
    video_id uuid,
    video_title <span class="predefined-type">text</span>,
    length <span class="predefined-type">int</span>
);</code></pre>
</div>
</div>
</section>
<section class="slide" id="java-driver-and-udts">
<h2>Java Driver and UDTs</h2>
<div class="ulist">
<ul>
<li>Get the UDT Value as a UDTValue</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">UDTValue videoUDT = row.getUDTValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">video</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>Get a collection of UDTValues (map example)</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">row.getMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">videos</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Date</span>.class, Video.class);</code></pre>
</div>
</div>
</section>
<section class="slide" id="setting-udt-values">
<h2>Setting UDT Values</h2>
<div class="ulist">
<ul>
<li>Set a collection of UDTValues on a <code>BoundStatement</code></li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">myStatement.setUDTValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">udt_field_name</span><span class="delimiter">&quot;</span></span>, udtPojoInstance);</code></pre>
</div>
</div>
</section>
<section class="slide" id="using-the-udt-value">
<h2>Using the UDT Value</h2>
<div class="ulist">
<ul>
<li>UDTValues have get/set methods similar to <code>Row</code> objects:</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">videoUDT.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>You can then construct a POJO:</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">Video video = <span class="keyword">new</span> Video();
video.setTitle(videoUDT.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</section>
<section class="slide" id="creating-a-new-udt-value">
<h2>Creating a new UDT Value</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
Get <code>UserType</code> for your type
</li>
<li>
Use <code>newValue()</code> method (returns <code>UDTValue</code>)
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">UserType videoType = session
    .getCluster()
    .getMetaData()
    .getKeyspace(<span class="string"><span class="delimiter">&quot;</span><span class="content">killrvideo</span><span class="delimiter">&quot;</span></span>)
    .getUserType(<span class="string"><span class="delimiter">&quot;</span><span class="content">video</span><span class="delimiter">&quot;</span></span>);
UDTValue videoUDT = videoType.newValue();
videoUDT.setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">Star Wars</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</section>
<section class="slide" id="mutating-collections">
<h2>Mutating Collections</h2>
<div class="ulist">
<ul>
<li>Collection elements may be mutated individually</li>
<li>However, reads always read the entire collection</li>
<li>Set example:</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="sql language-sql"><span class="class">UPDATE</span> users <span class="class">SET</span> things = things + {<span class="string"><span class="delimiter">&quot;</span><span class="content">box</span><span class="delimiter">&quot;</span></span>};</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>Lists may be prepended:</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="sql language-sql">things = [<span class="string"><span class="delimiter">&quot;</span><span class="content">box</span><span class="delimiter">&quot;</span></span>] + things;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>Lists items may be mutated:</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="sql language-sql">things[<span class="integer">3</span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">box</span><span class="delimiter">&quot;</span></span>;</code></pre>
</div>
</div>
</section>
<section class="slide" id="mutating-maps">
<h2>Mutating Maps</h2>
<div class="ulist">
<ul>
<li>Maps are sets where each element has an associated value:</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="sql language-sql"><span class="class">UPDATE</span> users <span class="class">SET</span> videos = videos + {<span class="string"><span class="delimiter">&quot;</span><span class="content">2015-12-18</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Star Wars</span><span class="delimiter">&quot;</span></span>};</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>Mutation:</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="sql language-sql">videos[<span class="string"><span class="delimiter">&quot;</span><span class="content">2015-12-18</span><span class="delimiter">&quot;</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">Star Wars - The Force Awakens</span><span class="delimiter">&quot;</span></span>;</code></pre>
</div>
</div>
</section>
<section class="slide" id="cql-maps-to-java-maps">
<h2>CQL Maps to Java Maps</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">Row row = resultSet.one();

newUser.setPhoneNumbers(
  row.getMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">phone_numbers</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class, <span class="predefined-type">BigDecimal</span>.class));</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li><code>getMap()</code> requires the column name, key type, and value type</li>
<li>When working with maps of UTDs, use <code>UDTValue.class</code> here</li>
</ul>
</div>
</section>
<section class="slide transition-azure" id="courses-DS420-components-exercises-java-driver-object-mapping-nesting-udts">
<h2>Exercise: Nesting UDTs</h2>
<div style="page-break-after: always"></div>
<div class="ulist">
<ul>
<li><p>
<span class="blue">Create</span><div class="ulist">
<ul>
<li>UDT for addresses. Follow the <em>Address</em> model object</li>
<li>Add a map column of &lt;String,Address&gt; to the user table</li>
</ul>
</div></p></li>
<li><p>
<span class="red">Code</span><div class="ulist">
<ul>
<li>Implement addressToUDT and UDTToAddress</li>
<li>Implement <code>addAddressToUser</code> using mutation syntax</li>
<li>Add the code to <code>getUser()</code> to include the users' addresses in the <code>User</code> object</li>
</ul>
</div></p></li>
<li><p>
<span class="green">Test</span><div class="ulist">
<ul>
<li>Run the test class UserDAOAddressTest</li>
</ul>
</div></p></li>
<li><p>
<span class="purple">Run</span><div class="ulist">
<ul>
<li>Create a new user and validate the users' address has been persisted correctly</li>
</ul>
</div></p></li>
</ul>
</div>
</section>
<section class="slide transition-green" id="courses-DS420-components-sections-java-driver-object-mapping-object-mapping-annotations">
<h2>Object Mapping &amp; Annotations</h2>

</section>
<section class="slide" id="overview-of-object-mapping">
<h2>Overview of Object Mapping</h2>
<div class="ulist">
<ul>
<li>Java driver maps objects to and from your tables</li>
<li>Removes the boilerplate serialization/deserialization code</li>
<li>The API is distributed in the <code>cassandra-driver-mapping</code> jar file</li>
</ul>
</div>
</section>
<section class="slide" id="annotations">
<h2>Annotations</h2>
<div class="paragraph"><p><strong>Annotate your POJOs to map to your underlying table</strong></p></div>
<div class="ulist">
<ul>
<li>Keyspace</li>
<li>Table name</li>
<li>Read Consistency</li>
<li>Write Consistency</li>
<li>Partition Keys</li>
<li>Clustering Columns</li>
<li>Columns</li>
</ul>
</div>
<div class="paragraph notes"><p>POJO = Plain Old Java Object</p></div>
</section>
<section class="slide" id="table">
<h2>@Table</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">videos</span><span class="delimiter">&quot;</span></span>,
       readConsistency = <span class="string"><span class="delimiter">&quot;</span><span class="content">LOCAL_ONE</span><span class="delimiter">&quot;</span></span>,
       writeConsistency = <span class="string"><span class="delimiter">&quot;</span><span class="content">LOCAL_QUORUM</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Video</span> {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph"><p>Parameters:</p></div>
<div class="ulist">
<ul>
<li>Table name</li>
<li>Keyspace (optional)</li>
<li>Read consistency (optional)</li>
<li>Write consistency (optional)</li>
<li>Case sensitivity of the names of keyspace and table</li>
</ul>
</div>
<div class="openblock notes">
<div class="content">
<div class="paragraph"><p>Keyspace is optional and in most cases it probably makes sense to not set this because if you want to test with a custom keyspace it will cause a conflict if specified.</p></div>
<div class="paragraph"><p><a class="bare" href="http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/mapping/annotations/Table.html">http://docs.datastax.com/en/drivers/java/3.0/com/datastax/driver/mapping/annotations/Table.html</a></p></div>
</div>
</div>
</section>
<section class="slide" id="column">
<h2>@Column</h2>
<div class="paragraph"><p><strong>Maps fields to columns</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Account</span> {
    <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">user_id</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">UUID</span> userId;
    <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">fname</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> firstName;
    ...
}</code></pre>
</div>
</div>
<div class="openblock notes">
<div class="content">
<div class="paragraph"><p>If you don&#8217;t use this annotation against a field, the driver will attempt to match the name of the field with a column name in the underlying table. If no matching column, then the driver will not serialize the field.</p></div>
</div>
</div>
</section>
<section class="slide" id="partitionkey">
<h2>@PartitionKey</h2>
<div class="paragraph"><p><strong>Determines which fields make up the partition key</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">videos</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Video</span> {
    <span class="annotation">@PartitionKey</span>(<span class="integer">0</span>)
    ...
    private <span class="predefined-type">UUID</span> videoID;

    <span class="annotation">@PartitionKey</span>(<span class="integer">1</span>)
    ...
    private <span class="predefined-type">UUID</span> anotherPossibleField;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>Composite keys require numeric argument</li>
</ul>
</div>
<div class="openblock notes">
<div class="content">
<div class="paragraph"><p>If you have a composite key (as shown in the example) then you need to specify the ordering of the keys using the ordinal property <code>@PartitionKey(0)</code>. If you only have a single partition key in a table then this is optional.</p></div>
</div>
</div>
</section>
<section class="slide" id="clusteringcolumn">
<h2>@ClusteringColumn</h2>
<div class="paragraph"><p><strong>Specify clustering columns</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">videos</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Video</span> {
    <span class="annotation">@PartitionKey</span>
    <span class="directive">private</span> <span class="predefined-type">UUID</span> videoID;

    <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">acct_id</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">UUID</span> acctId;

    <span class="annotation">@ClusteringColumn</span>
    <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">txn_id</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">UUID</span> txnId;
    ...
}</code></pre>
</div>
</div>
<div class="openblock notes">
<div class="content">
<div class="paragraph"><p>If you have more than one clustering column you should specify the ordinal placement using <code>@ClusteringColumn(&#8230;&#8203;)</code>.</p></div>
</div>
</div>
</section>
<section class="slide" id="frozen">
<h2>@Frozen</h2>
<div class="paragraph"><p><strong>Specifies frozen fields</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">...
    <span class="annotation">@Frozen</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">map&lt;frozen&lt;customtype&gt;,text&gt;</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;MyFrozenType,<span class="predefined-type">String</span>&gt; widgetManufacturers;
    ...
    <span class="annotation">@Frozen</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">set&lt;text&gt;</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; tags;
    ...</code></pre>
</div>
</div>
<div class="paragraph notes"><p>Frozen indicates types that are serialized as a single value.</p></div>
</section>
<section class="slide" id="frozenvalue">
<h2>@FrozenValue</h2>
<div class="paragraph"><p><strong>Can be more specific</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Account</span> {
    ...
    <span class="annotation">@FrozenValue</span>
    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;Address&gt; addresses;
    ...
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>Indicates <code>Address</code> is frozen.</li>
</ul>
</div>
</section>
<section class="slide" id="frozenkey">
<h2>@FrozenKey</h2>
<div class="paragraph"><p><strong>Indicates field&#8217;s key is frozen</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Widgets</span> {
    ...
    <span class="annotation">@FrozenKey</span>
    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;MyFrozenType,<span class="predefined-type">String</span>&gt; widgetManufacturers;
    ...
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="udt">
<h2>@UDT</h2>
<div class="paragraph"><p><strong>Indicates a POJO correlates to a UDT</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@UDT</span> (name=<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Address</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> street;
    <span class="directive">private</span> <span class="predefined-type">String</span> city;
    <span class="directive">private</span> <span class="type">int</span> zipCode;
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Phone&gt; phones;
        ...
}</code></pre>
</div>
</div>
<div class="paragraph"><p>Optional parameters are:</p></div>
<div class="ulist">
<ul>
<li>keyspace</li>
<li>caseSensitiveType</li>
<li>caseSensitiveKeyspace</li>
</ul>
</div>
<div class="paragraph notes"><p>Once again it&#8217;s probably a good idea not to specify the keyspace in the declaration as it limits flexibility.</p></div>
</section>
<section class="slide" id="transient">
<h2>@Transient</h2>
<div class="paragraph"><p><strong>Indicates a field does not map to a column</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Transient</span>
<span class="directive">private</span> <span class="predefined-type">String</span> sideNote;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>Helper fields for your code</li>
</ul>
</div>
<div class="paragraph notes"><p>This allows to have fields that are manipulated/used in your code as part of your object, but not stored in the database. Transient and Column are exclusive.</p></div>
</section>
<section class="slide" id="computed">
<h2>@Computed</h2>
<div class="paragraph"><p><strong>Calculated column values</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@PartitionKey</span>
<span class="annotation">@Column</span>
<span class="directive">private</span> <span class="predefined-type">UUID</span> uid;

<span class="annotation">@Computed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">writetime(first_name)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Date</span> writeTime;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="cql language-cql">SELECT first_name, writetime(first_name)
FROM users;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>Ignored on write</li>
</ul>
</div>
</section>
<section class="slide" id="mappingmanager">
<h2>MappingManager</h2>
<div class="paragraph"><p><strong>Creates mappers given a <code>Class&lt;T&gt;</code> argument</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">MappingManager mappingManager = <span class="keyword">new</span> MappingManager(session);
Mapper&lt;Video&gt; mapper = mappingManager.mapper(Video.class);</code></pre>
</div>
</div>
</section>
<section class="slide" id="mapper">
<h2>Mapper</h2>
<div class="paragraph"><p><strong>Maps your annotated object to the database</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">Video myVideo = <span class="keyword">new</span> Video();
myVideo.setID(...);
myVideo.setTitle(<span class="string"><span class="delimiter">&quot;</span><span class="content">Betsy's Adventures</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// etc.</span>

mapper.save(myVideo);
Cow myVideoCopy = mapper.get(myVideo.ID)</code></pre>
</div>
</div>
</section>
<section class="slide transition-azure" id="courses-DS420-components-exercises-java-driver-object-mapping-object-mapping-annotations">
<h2>Exercise: Object Mapping</h2>
<div style="page-break-after: always"></div>
<div class="ulist">
<ul>
<li><p>
<span class="blue">Annotate</span><div class="ulist">
<ul>
<li>Add annotations to the <code>Video</code> class</li>
</ul>
</div></p></li>
<li><p>
<span class="red">Map</span><div class="ulist">
<ul>
<li>Use the mapper to retrieve the video data</li>
</ul>
</div></p></li>
<li><p>
<span class="green">View</span><div class="ulist">
<ul>
<li>Look at videos in the web UI</li>
</ul>
</div></p></li>
</ul>
</div>
</section>
<section class="slide transition-green" id="courses-DS420-components-sections-java-driver-object-mapping-accessors">
<h2>Accessors</h2>

</section>
<section class="slide" id="accessors">
<h2>Accessors</h2>
<div class="ulist">
<ul>
<li>`Accessor`s allow more complex queries than basic object retrieval and saving</li>
<li>We then can provide domain-specific method names DAO objects as well</li>
</ul>
</div>
</section>
<section class="slide" id="accessor">
<h2>@Accessor</h2>
<div class="paragraph"><p><strong>Step 1</strong></p></div>
<div class="ulist">
<ul>
<li>Create a Java interface</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Accessor</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">VideosAccessor</span> {
  .
  .
  .</code></pre>
</div>
</div>
</section>
<section class="slide" id="query">
<h2>@Query</h2>
<div class="paragraph"><p><strong>Step 2</strong></p></div>
<div class="ulist">
<ul>
<li>Annotate methods with the <code>@Query</code> annotation</li>
<li>These correlate to named placeholders in your query string</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Accessor</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">VideosAccessor</span> {
  <span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM videos WHERE video_id = :video_id and </span><span class="delimiter">&quot;</span></span> +
         <span class="string"><span class="delimiter">&quot;</span><span class="content">added_year &gt; :added_year ORDER BY release_date DESC LIMIT 1</span><span class="delimiter">&quot;</span></span>)
  Video getLastVideo(<span class="predefined-type">UUID</span> videoId, <span class="type">int</span> addedYear);
  ...
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="param">
<h2>@Param</h2>
<div class="paragraph"><p><strong>Step 3</strong></p></div>
<div class="ulist">
<ul>
<li>Add <code>@Param</code> annotations</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Accessor</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">VideosAccessor</span> {

  <span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM videos WHERE video_id = :video_id and </span><span class="delimiter">&quot;</span></span> +
         <span class="string"><span class="delimiter">&quot;</span><span class="content">added_year &gt; :added_year ORDER BY release_date DESC LIMIT 1</span><span class="delimiter">&quot;</span></span>)
  Video getLastVideo(<span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">video_id</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">UUID</span> videoId,
                     <span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">added_year</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> addedYear);
  ...
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="instantiate">
<h2>Instantiate</h2>
<div class="paragraph"><p><strong>Step 4</strong></p></div>
<div class="ulist">
<ul>
<li>Use the mapper to create an accessor instance</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">VideosAccessor videoQueries =
    mapper.getManager().createAccessor(VideosAccessor.class);</code></pre>
</div>
</div>
</section>
<section class="slide" id="call-your-function">
<h2>Call Your Function</h2>
<div class="paragraph"><p><strong>Step 5</strong></p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="predefined-type">Result</span>&lt;Video&gt; lastVideo =
    videoQueries.getLastVideo(videoID, <span class="integer">2014</span>);</code></pre>
</div>
</div>
</section>
<section class="slide transition-azure" id="courses-DS420-components-exercises-java-driver-object-mapping-accessors">
<h2>Exercise: Accessors</h2>
<div style="page-break-after: always"></div>
<div class="ulist">
<ul>
<li><p>
<span class="blue">Create</span><div class="ulist">
<ul>
<li>Make an accessor interface</li>
<li>Determine the appropriate query</li>
</ul>
</div></p></li>
<li><p>
<span class="red">Code</span><div class="ulist">
<ul>
<li>Use your accessor to retrieve videos for a user</li>
</ul>
</div></p></li>
<li><p>
<span class="purple">Run</span><div class="ulist">
<ul>
<li>Start the application and view a user&#8217;s videos</li>
</ul>
</div></p></li>
</ul>
</div>
</section>
<div aria-role="navigation">
<a class="deck-prev-link" href="#" title="Previous">
<i class="icon-chevron-with-circle-left"></i>
</a>
<a class="deck-next-link" href="#" title="Next">
<i class="icon-chevron-with-circle-right"></i>
</a>
</div>
<form action="." class="goto-form" method="get">
<label for="goto-slide">Go to Slide:</label>
<input id="goto-slide" list="goto-datalist" name="slidenum" type="text" />
<datalist id="goto-data-list"></datalist>
<input type="submit" value="Go" />
</form>
</div>
<script src="deck.js/jquery.min.js"></script>
<script src="deck.js/d3.v2.js"></script>
<script src="deck.js/jquery-ui.min.js"></script>
<script src="deck.js/core/deck.core.js"></script>
<script src="deck.js/extensions/scale/deck.scale.js"></script>
<script src="deck.js/extensions/goto/deck.goto.js"></script>
<script src="deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="deck.js/extensions/split/deck.split.js"></script>
<script src="deck.js/extensions/animation/deck.animation.js"></script>
<script src="deck.js/extensions/deck.js-notes/deck.notes.js"></script>
<script src="deck.js/extensions/goto/deck.goto.js"></script>
<script src="deck.js/extensions/clone/deck.clone.js"></script>
<script src="deck.js/extensions/svg/svg.min.js"></script>
<script src="js/module-4.js"></script>
<footer>
<div class="flex-element deck-course">
<p>&copy; 2016 DataStax. Use only with permission. &bull;
<span class="course-title">Core Java: Object Mapping &amp; Annotations</span></p>
</div>
<div class="flex-element deck-brand">
<a href="http://academy.datastax.com" target="blank">DataStax Academy</a>
</div>
<div class="deck-progressbar">
<span></span>
</div>
</footer>
<script type="text/javascript">
  //<![CDATA[
    (function($, deck, undefined) {
      $.deck.defaults.keys['previous'] = [8, 33, 37, 39];
      $.deck.defaults.keys['next'] = [13, 32, 34, 39];
    
      $.extend(true, $[deck].defaults, {
          countNested: false
      });
    
      $.deck('.slide');
      $.deck('disableScale');
    })(jQuery, 'deck');
  //]]>
</script>
<script type="text/javascript">
  //<![CDATA[
    $(document).bind('deck.change', function(event, from, to) {
      var width = to / ($.deck('getSlides').length - 1) * 100;
      $('.deck-progressbar span').css('width', width + '%');
    });
  //]]>
</script>
</body>
</html>