<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]>
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<![endif]-->
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="Asciidoctor 1.5.3" name="generator">
<title>Building a Killr Application with Apache Cassandra</title>
<style>/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0;}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{color:rgba(0,0,0,.8); background:#fafafa;padding:0;margin:0;font-family:"Helvetica Neue",  helvetica, arial, verdana, sans-serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Helvetica Neue", helvetica, arial,sans-serif;font-weight:300;font-style:normal;color:#BC5E2E;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header {background: url('deck.js/themes/style/images/bg-pattern-blue.png') bottom left; color: #F8F7F6; text-align: center; min-height: 320px; padding: 30px 0;}
	#header .brand {width: 225px; height: 69px; background-size: 225px 69px; margin: 1em auto; background:url('deck.js/themes/style/images/academy-logo-white.svg') no-repeat;}
	#header>h1 {color: #F8F7F6; font-size: 3.75em;; margin-top: .5em;}
#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em;}
#content:before{content:none}
	#content .sect1 h2 {color: #374c51; font-weight: 300; text-align: center;}
	#content .sect1 {}
	.sect1{padding-bottom:.625em}
	@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
	.sect1+.sect1{}

	.sect1 h4 {color: #22836A;}
	.sect h4 strong {font-weight: bold;}
	.sectionbody  {background: white; border-radius: 3px; padding: 1.5em;}
	.sectionbody ol {list-style-position: inside; margin-left: 0;}
	.sectionbody ol li {border-bottom: 1px solid #ebeee8;}
	.sectionbody ol li:hover {background: #fafafa;}
	.sectionbody ol li p {margin-bottom: 0;}
	.sectionbody ol li a {text-decoration: none; color: #374c51; display: block; padding: 1em;}

#header>h1:first-child{color: #F8F7F6;margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}

#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#BC5E2E;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
/*.admonitionblock {margin: 1.5em 0;}
   	.admonitionblock.note .icon-note::before, .admonitionblock .tip .icon-tip::before {content: "\ea0c"; color: #1B7387;}
    .admonitionblock.important .icon-important::before {content: "\ea07"; color: #22836A;}
    .admonitionblock.warning .icon-warning::before {content: "\f08f"; color: #BC5E2E;}
    .admonitionblock.caution .icon-caution::before {content: "\ea08"; color: #D2A854;}
    .admonitionblock .icon {font-size: 3.5em; padding: .25em; border-right: 3px solid #E3E4E3;}
    .admonitionblock .content {vertical-align: middle; padding: .25em;}
*/


.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}</style>
<style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style>
</head>
<body class="article">
<div id="header">
<div class="brand"></div>
<h1>Building a Killr Application with Apache Cassandra</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="solutions">Solutions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction">Introduction</h3>

</div>
<div class="sect2">
<h3 id="core-java-driver-configuration">Core Java: Driver Configuration</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="SOLUTION-1">Solution 1: Session Object</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This exercise is designed to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Session with the Cassandra Driver</p>
</li>
<li>
<p>Test using the Session tests</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All exercises have most of the code stubbed out for you. Your task is to fill in the blanks.</p>
</div>
<div class="paragraph">
<p>Checkout the branch for this exercise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">git checkout exercise1</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="step-1">Step 1:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go back to your editor and navigate to <code>webapp/src/test/java/com/datastax/training/killrvideo/util/CassandraSessionTest.java</code></p>
</li>
<li>
<p>Examine the test. Notice it creates a the <code>killrvideo</code> keyspace using the settings found in <code>webapp/src/test/java/test-properties.conf</code>.</p>
</li>
<li>
<p>Run <code>CassandraSessionTest.java</code> (doing so varies depending on the IDE you are using).</p>
</li>
<li>
<p>You see the test currently fails. :(</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="step-2">Step 2:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go back to your IDE and navigate to <code>webapp/src/main/java/com/datastax/training/killrvideo/util/CassandraSession.java</code>.</p>
</li>
<li>
<p>Notice the empty <code>initCassandra()</code> function.</p>
</li>
<li>
<p>Write code using the given parameters which creates a <code>Cluster</code> and initializes the class-level <code>session</code> variable.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cluster cluster = Cluster.builder()
        .withCredentials(username, password)
        .addContactPoints(contactpoints)
        .build();
session = cluster.connect(keyspace);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Notice Cluster is not defined. Add the appropriate import for Cluster:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.datastax.driver.core.Cluster</span>;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Save All (Ctrl-S).</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="step-3">Step 3:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the test again.</p>
</li>
<li>
<p>It should pass.</p>
</li>
<li>
<p>WOOT!</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="core-java-core-concepts">Core Java: Core Concepts</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="SOLUTION-2">Solution 2: Simple Statements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This exercise is designed to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Query user using raw <code>execute()</code> command in the <code>getUser()</code> method</p>
</li>
<li>
<p>Add user by creating a <code>SimpleStatement</code> object in the <code>addUser()</code> method</p>
</li>
<li>
<p>Run the associated unit test</p>
</li>
<li>
<p>Test website registration and login functionality</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here is the CQL for the <code>user</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cql">CREATE TABLE user (
    email text PRIMARY KEY,
    addresses map&lt;text,frozen&lt;address&gt;&gt;,
    phone_numbers map&lt;text, decimal&gt;,
    joined timestamp,
    fname text,
    lname text,
    password blob,
    salt blob,
    user_id uuid
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the corresponding <code>User</code> Java class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> email;
    <span class="directive">private</span> <span class="predefined-type">String</span> firstName;
    <span class="directive">private</span> <span class="predefined-type">String</span> lastName;
    <span class="directive">private</span> <span class="predefined-type">Date</span> joined;
    <span class="directive">private</span> <span class="predefined-type">ByteBuffer</span> password;
    <span class="directive">private</span> <span class="predefined-type">ByteBuffer</span> salt;
    <span class="directive">private</span> <span class="predefined-type">UUID</span> userId;
    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">BigDecimal</span>&gt; phoneNumbers;
    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, Address&gt; addresses;

    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this exercise, you will use a <code>SimpleStatement</code> to map the fields in between Java and CQL.</p>
</div>
<div class="paragraph">
<p>Checkout the branch for this exercise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">git checkout exercise2</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="step-1">Step 1:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you haven&#8217;t already done so, launch your IDE and open the <code>killrvideo</code> project.</p>
</li>
<li>
<p>Navigate to <code>/webapp/src/test/java/com/datastax/training/killrvideo/dao/cassandra/UserDAOTest.java</code></p>
</li>
<li>
<p>This test adds a user and verifies the results. It also adds the same user twice, expecting an exception on the second try.</p>
</li>
<li>
<p>Run the test, and verify that it fails.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img alt="test failure" src="images/courses/DS420/components/exercises/java-driver-core-concepts/simple-statements/test_failure.png">
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-2">Step 2:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the IDE, navigate to <code>webapp/src/main/java/com/datastax/training/killrvideo/model/dao/cassandra/CassandraUserDAO.java</code></p>
</li>
<li>
<p>Simplest way to use <code>session.execute()</code> is to pass your SQL query directly to the call.</p>
</li>
<li>
<p>In the <code>CassandraUserDAO</code>, find the <code>getUser()</code> method.</p>
</li>
<li>
<p>Add code that uses <code>session.execute()</code> to retrieve a user with a provided email address.</p>
</li>
<li>
<p>Pass a raw command string to <code>execute()</code>.</p>
</li>
<li>
<p>If your result set is empty, return null.</p>
</li>
<li>
<p>Otherwise, instantiate a <code>User</code> object and extract the data members from the result set.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The method should extract the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>email TEXT
phone_numbers MAP&lt;TEXT, DECIMAL&gt;
joined TIMESTAMP
fname TEXT
lname TEXT
password BLOB
salt BLOB
user_id UUID</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note that you do not need to extract the <code>phone_numbers</code> and <code>addresses</code> column.</strong></p>
</div>
<div class="paragraph">
<p>Finally, return your <code>User</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="predefined-type">ResultSet</span> resultSet = session.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user WHERE email = '</span><span class="delimiter">&quot;</span></span> + email + <span class="string"><span class="delimiter">&quot;</span><span class="content">'</span><span class="delimiter">&quot;</span></span>);

    <span class="keyword">if</span> (resultSet.isExhausted()) {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }

    Row row = resultSet.one();

    User newUser = <span class="keyword">new</span> User();
    newUser.setEmail(row.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>));
    newUser.setFirstName(row.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">fname</span><span class="delimiter">&quot;</span></span>));
    newUser.setLastName(row.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">lname</span><span class="delimiter">&quot;</span></span>));
    newUser.setJoined(row.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">joined</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Date</span>.class));
    newUser.setPassword(row.getBytes(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>));
    newUser.setSalt(row.getBytes(<span class="string"><span class="delimiter">&quot;</span><span class="content">salt</span><span class="delimiter">&quot;</span></span>));
    newUser.setUserId(row.getUUID(<span class="string"><span class="delimiter">&quot;</span><span class="content">user_id</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-3">Step 3:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find the <code>addUser()</code> method.</p>
</li>
<li>
<p>Add code to instantiate a <code>SimpleStatement</code> object that executes an INSERT command to insert the data members of the <code>newUser</code> parameter. Use a lightweight transaction so that the same user is not added more than once.</p>
</li>
<li>
<p>Your insert statement needs the following parameters: email, joined, user_id, fname, lname, password, salt. You <strong>do not</strong> need to insert phone_numbers or addresses.</p>
</li>
<li>
<p>Pass your <code>SimpleStatement</code> instance to <code>session.execute()</code>.</p>
</li>
<li>
<p>Add code to ensure your results were applied by calling <code>wasApplied()</code> on the <code>ResultSet</code>.</p>
</li>
<li>
<p>If the results were not applied, throw a <code>UserAlreadyExistsException</code>. The constructor for the <code>UserAlreadyExistsException</code> requires a string describing the error.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  SimpleStatement statement = <span class="keyword">new</span> SimpleStatement(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO USER (email, joined, user_id, fname, lname, password, salt) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">VALUES (:email,:joined,:user_id,:fname,:lname,:password,:salt) IF NOT EXISTS</span><span class="delimiter">&quot;</span></span>,
    newUser.getEmail(), newUser.getJoined(), newUser.getUserId(), newUser.getFirstName(),
    newUser.getLastName(), newUser.getPassword(), newUser.getSalt());

  <span class="predefined-type">ResultSet</span> result = session.execute(statement);
  <span class="keyword">if</span> (!result.wasApplied()) {
      <span class="keyword">throw</span> <span class="keyword">new</span> UserAlreadyExistsException(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Could not save user with the specified id. A duplicate already exists</span><span class="delimiter">&quot;</span></span>);
  }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-4">Step 4:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your editor, navigate to <code>/webapp/src/test/java/com/datastax/training/killrvideo/dao/cassandra/UserDAOTest.java</code></p>
</li>
<li>
<p>Run the test. It should pass.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="step-5">Step 5:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your IDE, navigate to <code>webapp/src/main/java/com/datastax/training/killrvideo/Main.java</code></p>
</li>
<li>
<p>Start the web app by running this file.</p>
</li>
<li>
<p>Once the app starts, open the web application in your browser at <code><a class="bare" href="http://localhost:8082">http://localhost:8082</a></code>.</p>
</li>
<li>
<p>Go ahead and register as a user.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SOLUTION-3">Solution 3: Prepared Statements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This exercise is designed to give you experience using prepared statements. You will implement the functionality to add a video to the website.</p>
</div>
<div class="paragraph">
<p>Checkout the branch for this exercise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">git checkout exercise3</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="step-1">Step 1:</h3>
<div class="paragraph">
<p>Start the web app and login.</p>
</div>
<div class="paragraph">
<p>The home screen will error out, but go ahead and click on "Add Videos" at the top. You can fill this form out if you like, but it will error out as well. Your task is to implement the functionality to add a video</p>
</div>
</div>
<div class="sect2">
<h3 id="step-2">Step 2:</h3>
<div class="paragraph">
<p>Review the schema for the <code>videos</code> table, either by viewing the <code>CREATE TABLE</code> statement in <code>create-schema.cql</code>, or viewing the schema for <code>videos</code> using <code>cqlsh</code> or <code>DevCenter</code>. Note the columns that make up the <code>videos</code> table.</p>
</div>
</div>
<div class="sect2">
<h3 id="step-3">Step 3:</h3>
<div class="paragraph">
<p>Navigate to <code>webapp/src/main/java/com/datastax/training/killrvideo/model/dao/cassandra/CassandraVideoDAO.java</code>. Notice the mostly empty <code>addVideo()</code> function. This function takes a <code>Video</code> parameter to save to the database.</p>
</div>
</div>
<div class="sect2">
<h3 id="step-4">Step 4:</h3>
<div class="paragraph">
<p>Add a class-level variable called <code>insertStatement</code> of type <code>PreparedStatement</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">PreparedStatement</span> insertStatement;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the <code>CassandraVideoDAO</code> constructor, initialize <code>insertStatement</code> to insert a new record into the <code>videos</code> table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">insertStatement = session.prepare(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO VIDEOS (video_id, user_id, title, type, </span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">release_date, description, mpaa_rating, genres, tags, </span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">preview_thumbnail, url, avg_rating) VALUES (</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">:video_id, :user_id, :title, :type, :release_date, </span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">:description, :mpaa_rating, :genres, :tags, </span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">:preview_thumbnail, :url, :avg_rating)</span><span class="delimiter">&quot;</span></span>
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ignore the <code>Calendar</code> code in the constructor. We will use this in a later exercise.</p>
</div>
</div>
<div class="sect2">
<h3 id="step-5">Step 5:</h3>
<div class="paragraph">
<p>Move to the <code>addVideo()</code> method. <code>bind()</code> your insert statement and set the appropriate column values from the <code>newVideo</code> parameter.</p>
</div>
<div class="paragraph">
<p>Be sure to <code>execute()</code> your <code>BoundStatement</code> before returning.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">boolean</span> addVideo(Video newVideo) <span class="directive">throws</span> VideoAlreadyExistsException {
    Session session = getCassandraSession();

    BoundStatement insertToVideos = insertStatement.bind();

    <span class="keyword">if</span> (newVideo.hasVideoId()) {
        insertToVideos.setUUID(<span class="string"><span class="delimiter">&quot;</span><span class="content">video_id</span><span class="delimiter">&quot;</span></span>, newVideo.getVideoId());
    }

    <span class="keyword">if</span> (newVideo.hasUserId()) {
        insertToVideos.setUUID(<span class="string"><span class="delimiter">&quot;</span><span class="content">user_id</span><span class="delimiter">&quot;</span></span>, newVideo.getUserId());
    }

    <span class="keyword">if</span> (newVideo.hasTitle()) {
        insertToVideos.setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, newVideo.getTitle());
    }

    <span class="keyword">if</span> (newVideo.hasType()) {
        insertToVideos.setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, newVideo.getType());
    }

    <span class="keyword">if</span> (newVideo.hasReleaseDate()) {
        insertToVideos.setTimestamp(<span class="string"><span class="delimiter">&quot;</span><span class="content">release_date</span><span class="delimiter">&quot;</span></span>, newVideo.getReleaseDate());
    }

    <span class="keyword">if</span> (newVideo.hasReleaseYear()) {
        insertToVideos.setInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">release_year</span><span class="delimiter">&quot;</span></span>, newVideo.getReleaseYear());
    }

    <span class="keyword">if</span> (newVideo.hasDescription()) {
        insertToVideos.setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>, newVideo.getDescription());
    }

    <span class="keyword">if</span> (newVideo.hasMpaaRating()) {
        insertToVideos.setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">mpaa_rating</span><span class="delimiter">&quot;</span></span>, newVideo.getMpaaRating());
    }

    <span class="keyword">if</span> (newVideo.hasGenres()) {
        insertToVideos.setSet(<span class="string"><span class="delimiter">&quot;</span><span class="content">genres</span><span class="delimiter">&quot;</span></span>, newVideo.getGenres());
    }

    <span class="keyword">if</span> (newVideo.hasTags()) {
        insertToVideos.setSet(<span class="string"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>, newVideo.getTags());
    }

    <span class="keyword">if</span> (newVideo.hasPreviewThumbnail()) {
        insertToVideos.setBytes(<span class="string"><span class="delimiter">&quot;</span><span class="content">preview_thumbnail</span><span class="delimiter">&quot;</span></span>, newVideo.getPreviewThumbnail());
    }

    <span class="keyword">if</span> (newVideo.hasUrl()) {
        insertToVideos.setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>, newVideo.getUrl());
    }

    insertToVideos.setFloat(<span class="string"><span class="delimiter">&quot;</span><span class="content">avg_rating</span><span class="delimiter">&quot;</span></span>, newVideo.getAvgRating());

    <span class="comment">// Execute the statement</span>
    <span class="predefined-type">ResultSet</span> result = session.execute(insertToVideos);

    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-6">Step 6:</h3>
<div class="paragraph">
<p>Restart the application and login to the site. Navigate to the "Add Video" table again and fill out the form. Be sure to submit your results. The form will error out, but your results should save. We will continue to complete the site functionality as we work through the exercises.</p>
</div>
</div>
<div class="sect2">
<h3 id="step-7">Step 7:</h3>
<div class="paragraph">
<p>Use either <code>DevCenter</code> or <code>cqlsh</code> to examine the contents of the <code>videos</code> table. Your video should appear as the only record.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SOLUTION-4">Solution 4: Query Builder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This exercise is designed to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Store new videos into the <code>latest_videos</code> table</p>
</li>
<li>
<p>Modify the <code>getLatestVideos()</code> method to extract the latest videos</p>
</li>
<li>
<p>Use <code>QueryBuilder</code> to retrieve videos from a bucket</p>
</li>
<li>
<p>Execute that query to populate a <code>ResultSet</code></p>
</li>
<li>
<p>Test website functionality</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Checkout the branch for this exercise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">git checkout exercise4</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="step-1">Step 1:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Launch your IDE and open the <code>killrvideo</code> project if necessary.</p>
</li>
<li>
<p>In the IDE, navigate to <code>webapp/src/main/java/com/datastax/training/killrvideo/model/dao/cassandra/CassandraVideoDAO.java</code></p>
</li>
<li>
<p>Find the <code>addVideo()</code> method that you implemented earlier.</p>
</li>
<li>
<p>Write code using <code>QueryBuilder</code> to insert the <code>newVideo</code> record data into the <code>latest_videos</code> table.</p>
</li>
<li>
<p>For the <code>bucket</code> column value, use the class level variable <code>currentDate</code>.</p>
</li>
<li>
<p>Refer back to the database schema if necessary to know what columns are in <code>latest_videos</code>.</p>
</li>
<li>
<p>Be sure to execute both your PreparedStatement for the <code>videos</code> table and Insert statement for the <code>latest_videos</code> at the end of the <code>addVideo()</code> function.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You are experiencing some of the effects of denormalization in that to add a new video record, we must store its values in the <code>videos</code> and <code>latest_videos</code> table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    Insert insertToLatestVideos = QueryBuilder.insertInto(<span class="string"><span class="delimiter">&quot;</span><span class="content">latest_videos</span><span class="delimiter">&quot;</span></span>)
                .value(<span class="string"><span class="delimiter">&quot;</span><span class="content">video_bucket</span><span class="delimiter">&quot;</span></span>, currentDate)
                .value(<span class="string"><span class="delimiter">&quot;</span><span class="content">video_id</span><span class="delimiter">&quot;</span></span>, newVideo.getVideoId())
                .value(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, newVideo.getTitle())
                .value(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, newVideo.getType())
                .value(<span class="string"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>, newVideo.getTags())
                .value(<span class="string"><span class="delimiter">&quot;</span><span class="content">preview_thumbnail</span><span class="delimiter">&quot;</span></span>, newVideo.getPreviewThumbnail());

    session.execute(insertToLatestVideos);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-2">Step 2:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find the mostly empty <code>getLatestVideos()</code> method.</p>
</li>
<li>
<p>Use <code>QueryBuilder</code> to retrieve the latest videos from the database and return the results via <code>latestVideos</code>.</p>
</li>
<li>
<p>For the <code>bucket</code> column value, again use the class level variable <code>currentDate</code>.</p>
</li>
<li>
<p>Be sure to limit your results to 12 records.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Iterable</span>&lt;Video&gt; getLatestVideos() {
    <span class="predefined-type">ArrayList</span>&lt;Video&gt; latestVideos = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;Video&gt;();
    <span class="predefined-type">Statement</span> selectLatestVideos = QueryBuilder
            .select()
            .from(<span class="string"><span class="delimiter">&quot;</span><span class="content">latest_videos</span><span class="delimiter">&quot;</span></span>)
            .where(QueryBuilder.eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">video_bucket</span><span class="delimiter">&quot;</span></span>, currentDate))
            .limit(<span class="integer">12</span>);

    <span class="predefined-type">ResultSet</span> rs = getCassandraSession().execute(selectLatestVideos);
    <span class="keyword">for</span> (Row row : rs) {
        Video newVideo = <span class="keyword">new</span> Video();
        newVideo.setVideoId(row.getUUID(<span class="string"><span class="delimiter">&quot;</span><span class="content">video_id</span><span class="delimiter">&quot;</span></span>));
        newVideo.setTitle(row.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>));
        newVideo.setType(row.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>));
        newVideo.setTags(row.getSet(<span class="string"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class));
        newVideo.setPreviewThumbnail(row.getBytes(<span class="string"><span class="delimiter">&quot;</span><span class="content">preview_thumbnail</span><span class="delimiter">&quot;</span></span>));

        latestVideos.add(newVideo);
    }
    <span class="keyword">return</span> latestVideos;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-3">Step 3:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Within <code>DevCenter</code> or <code>cqlsh</code>, use the TRUNCATE command to delete all the data in the <code>videos</code> table.</p>
</li>
<li>
<p>Launch the web application.</p>
</li>
<li>
<p>Navigate to the "Add Video" tab and add at least one video. The page will error out still, but the video record should insert into the <code>videos</code> and <code>latest_videos</code> tables.</p>
</li>
<li>
<p>Navigate to the "Latest Videos" tab. Up to 12 videos will appear (depending on how many you added).</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SOLUTION-5">Solution 5: Batches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This exercise is designed to use batches by adding multiple statements to a single batch.</p>
</div>
<div class="paragraph">
<p>Checkout the branch for this exercise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">git checkout exercise5</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="step-1">Step 1:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Launch your IDE if necessary and open the <code>killrvideo</code> project.</p>
</li>
<li>
<p>In the IDE, navigate to <code>webapp/src/main/java/com/datastax/training/killrvideo/model/dao/cassandra/CassandraVideoDAO.java</code></p>
</li>
<li>
<p>Find the <code>addVideo()</code> method that you have worked on in previous exercises.</p>
</li>
<li>
<p>Note that you have two insert statements: one for <code>videos</code> and one for <code>latest_videos</code>. If either of these inserts fail, your tables will be out of sync.</p>
</li>
<li>
<p>Combine both of your insert statements into a <code>BatchStatement</code> object.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">BatchStatement insertVideoBatch = <span class="keyword">new</span> BatchStatement();
insertVideoBatch.add(insertToVideos);
insertVideoBatch.add(insertToLatestVideos);</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pass your batch statement to <code>execute()</code> instead of calling <code>execute()</code> on each insert individually.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">ResultSet</span> result = session.execute(insertVideoBatch);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-2">Step 2:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Relaunch the web app and navigate to the "Add Video" tab.</p>
</li>
<li>
<p>Use the form to add a new video.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="step-3">Step 3:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the "Latest Videos" tab and ensure your video appears in the list.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="core-java-object-mapping-annotations">Core Java: Object Mapping &amp; Annotations</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="SOLUTION-6">Solution 6: Nesting User Defined Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This exercise will help you:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Understand how UDTs work with the DataStax drivers</p>
</li>
<li>
<p>Understand how to work with nested UDTs</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We will add an <code>address</code> user defined type to our users.</p>
</div>
<div class="paragraph">
<p>Checkout the branch for this exercise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">git checkout exercise6</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="step-1">Step 1</h3>
<div class="paragraph">
<p>Below is the CREATE TABLE for the <code>address</code> UDT and <code>user</code>. You can also see this in the <code>datamodel/cql/create-schema.cql</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> TYPE address (
    street <span class="predefined-type">text</span>,
    city <span class="predefined-type">text</span>,
    postalcode <span class="predefined-type">text</span>,
    country <span class="predefined-type">text</span>
);

<span class="class">CREATE</span> <span class="type">TABLE</span> user (
    email <span class="predefined-type">text</span> <span class="directive">PRIMARY</span> <span class="type">KEY</span>,
    addresses map&lt;<span class="predefined-type">text</span>,frozen&lt;address&gt;&gt;,
    phone_numbers map&lt;<span class="predefined-type">text</span>, <span class="predefined-type">decimal</span>&gt;,
    created <span class="predefined-type">timestamp</span>,
    fname <span class="predefined-type">text</span>,
    lname <span class="predefined-type">text</span>,
    password <span class="predefined-type">blob</span>,
    salt <span class="predefined-type">blob</span>,
    user_id uuid
);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-2">Step 2</h3>
<div class="paragraph">
<p>This is a sample 1-n diagram. The exercise will implement a 1-n relationship with user and addresses.</p>
</div>
<div class="imageblock center">
<div class="content">
<img alt="model" src="images/courses/DS420/components/exercises/java-driver-object-mapping/nesting-udts/model.svg">
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-3">Step 3</h3>
<div class="paragraph">
<p>Navigate to <code>webapp/src/test/java/com/datastax/training/killrvideo/dao/cassandra/UserDAOAddressTest.java</code>. Look over the tests to get a feel for what they are doing. Essentially, they are testing storing and retrieving user address information.</p>
</div>
<div class="paragraph">
<p>Notice part of the tests are commented out so that the project can build. Uncomment such code.</p>
</div>
<div class="imageblock">
<div class="content">
<img alt="uncomment" src="images/courses/DS420/components/exercises/java-driver-object-mapping/nesting-udts/uncomment.png">
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-4">Step 4</h3>
<div class="paragraph">
<p>Open the <code>webapp/src/main/java/com/datastax/training/killrvideo/model/dao/Address.java</code> class file. Notice this entity is a simple POJO Java class.</p>
</div>
<div class="paragraph">
<p>Open the <code>User.java</code> file (in that same directory) and add a <code>private Map&lt;String, Address&gt; addresses;</code> field to the <code>User</code> class. Also add appropriate <code>setAddresses()</code> and <code>getAddresses()</code> functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, Address&gt; addresses;

<span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, Address&gt; getAddresses() { <span class="keyword">return</span> addresses; }

<span class="directive">public</span> <span class="type">void</span> setAddresses(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, Address&gt; addresses) { <span class="local-variable">this</span>.addresses = addresses; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how <code>Address</code> is now a nested structure in the <code>User</code> class using a <code>Map&lt;string, Address&gt;</code> reflecting the same structure in our database. The <code>String</code> keys in this situation would be "home", "work", etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="step-5">Step 5:</h3>
<div class="paragraph">
<p>Open <code>webapp/src/main/java/com/datastax/training/killrvideo/model/dao/cassandra/CassandraUserDAO.java</code> file.</p>
</div>
<div class="paragraph">
<p>Add a <code>private PreparedStatement addAddressToUserStatement;</code> field to the class as well. In the constructor, initialize <code>addAddressToUserStatement</code> to update the <code>user</code> table and set a single address within the <code>user&#8217;s `addresses</code> map, given an <code>addressName</code> (text), an <code>address</code> value, and a user&#8217;s <code>email</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">addAddressToUserStatement = session.prepare(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">UPDATE user </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">SET addresses[:addressName] = :address </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">WHERE email = :email</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-6">Step 6:</h3>
<div class="paragraph">
<p>Navigate to <code>addAddressToUser()</code>. This method&#8217;s job is to save its parameter values to the database. Within this method, create a <code>BoundStatement</code> from the <code>addAddressToUserStatement</code> you just made. Bind the method&#8217;s parameters as arguments to your newly created <code>BoundStatement</code>.</p>
</div>
<div class="paragraph">
<p>In setting your <code>address</code> column value for your bound statement, you will have to convert the <code>Address newAddress</code> parameter value to a <code>UDTValue</code>. Call <code>addressToUDT()</code> to do this for you.</p>
</div>
<div class="paragraph">
<p>Be sure to <code>execute()</code> your bound statement before returning.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  BoundStatement boundStatement =
          addAddressToUserStatement.bind()
                  .setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>, email)
                  .setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">addressName</span><span class="delimiter">&quot;</span></span>, addressName)
                  .setUDTValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, addressToUDT(newAddress));

  session.execute(boundStatement);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-7">Step 7:</h3>
<div class="paragraph">
<p>Navigate to <code>addressToUDT()</code>. This function takes an <code>Address</code> object and creates a <code>UDTValue</code> from it. To implement this function, you need a <code>UserType</code> first.</p>
</div>
<div class="paragraph">
<p>Add a <code>private UserType addressType;</code> field to <code>CassandraUserDAO</code>, and in the constructor, initialize it to represent the CQL <code>Address</code> user defined type.  When retrieving the user defined type, use the method <code>getCassandraSession().getLoggedKeyspace()</code> to pass in the keyspace you want to retrieve the UDT from.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">addressType = session.getCluster()
        .getMetadata()
        .getKeyspace(getCassandraSession()
        .getLoggedKeyspace())
        .getUserType(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Navigate back to <code>addressToUDT()</code> and implement it appropriately. Use your new <code>addressType</code> field to create and return a new <code>UDTValue</code> instance from the <code>address</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">return</span> addressType.newValue()
      .setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">street</span><span class="delimiter">&quot;</span></span>, address.getStreet())
      .setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>, address.getCity())
      .setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">country</span><span class="delimiter">&quot;</span></span>, address.getCountry())
      .setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">postalcode</span><span class="delimiter">&quot;</span></span>, address.getPostalCode());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-8">Step 8:</h3>
<div class="paragraph">
<p>Navigate to the <code>getUser()</code> method. Towards the end of the method, write code to pull the <code>addresses</code> column values from the <code>user</code> table and convert the values to Java <code>Address</code> objects. Store these objects in a <code>Map&lt;String, Address&gt;</code> which you can then send to <code>newUser</code> by calling <code>setAddresses()</code>.</p>
</div>
<div class="paragraph">
<p>To convert the UDT address value to a Java <code>Address</code> instance, call <code>UDTToAddress()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, UDTValue&gt; uDTAddresses = row.getMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">addresses</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class, UDTValue.class);
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, Address&gt; addresses = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;(uDTAddresses.size());

<span class="keyword">for</span> (<span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, UDTValue&gt; entry : uDTAddresses.entrySet())
    addresses.put(entry.getKey(), UDTToAddress(entry.getValue()));

newUser.setAddresses(addresses);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-9">Step 9:</h3>
<div class="paragraph">
<p>Navigate to <code>UDTToAddress()</code>. Write code to instantiate a new <code>Address</code> instance and populate it with the values from the <code>udtValue</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Address newAddress = <span class="keyword">new</span> Address();

newAddress.setCity(udtValue.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>));
newAddress.setCountry(udtValue.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">country</span><span class="delimiter">&quot;</span></span>));
newAddress.setStreet(udtValue.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">street</span><span class="delimiter">&quot;</span></span>));
newAddress.setPostalCode(udtValue.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">postalCode</span><span class="delimiter">&quot;</span></span>));

<span class="keyword">return</span> newAddress;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-10">Step 10</h3>
<div class="paragraph">
<p>Run the <code>UserDAOAddressTest.java</code> tests. All tests should pass.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SOLUTION-7">Solution 7: Object Mapping and Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This exercise provides you with hands on experience using object mapping annotations.</p>
</div>
<div class="paragraph">
<p>In this exercise, you will retrieve <code>Video</code> instances from the database using the <code>Mapper</code> class.</p>
</div>
<div class="paragraph">
<p>Checkout the branch for this exercise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">git checkout exercise7</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="step-1">Step 1:</h3>
<div class="paragraph">
<p>Navigate to <code>src/main/java/com/datastax/training/killrvideo/model/dao/Video.java</code>. Add the appropriate annotations to the <code>Video</code> class to make it compatible with the <code>Mapper</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.datastax.training.killrvideo.model</span>;

<span class="keyword">import</span> <span class="include">com.datastax.driver.mapping.annotations</span>.*;
<span class="keyword">import</span> <span class="include">com.fasterxml.jackson.annotation.JsonIgnoreProperties</span>;

<span class="keyword">import</span> <span class="include">java.nio.ByteBuffer</span>;
<span class="keyword">import</span> <span class="include">java.util</span>.*;

<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">videos</span><span class="delimiter">&quot;</span></span>, readConsistency = <span class="string"><span class="delimiter">&quot;</span><span class="content">LOCAL_ONE</span><span class="delimiter">&quot;</span></span>, writeConsistency = <span class="string"><span class="delimiter">&quot;</span><span class="content">LOCAL_QUORUM</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Video</span> {

    <span class="annotation">@PartitionKey</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">video_id</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">UUID</span> videoId;

    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> description;
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> title;
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> type;
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> url;
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">release_date</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">Date</span> releaseDate;
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">release_year</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="type">int</span> releaseYear;
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">avg_rating</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="type">float</span> avgRating;
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">mpaa_rating</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> mpaaRating;
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; tags;
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">preview_thumbnail</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">ByteBuffer</span> previewThumbnail;
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">genres</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; genres;
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">user_id</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">UUID</span> userId;

    <span class="comment">// gets/sets etc.</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-2">Step 2:</h3>
<div class="paragraph">
<p>Navigate to <code>src/main/java/com/datastax/training/killrvideo/model/dao/cassandra/CassandraVideoDAO.java</code>. Scroll down to the <code>getVideo()</code> function. Notice it currently only returns null. Change this function to use the <code>Mapper</code> instance named <code>mapper</code> found in the base class <code>AbstractMapperDAO</code>. <code>AbstractMapperDAO</code> has already created the <code>mapper</code> instance for you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> Video getVideo(<span class="predefined-type">UUID</span> video_id) {
    <span class="keyword">return</span> mapper.get(video_id);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-3">Step 3:</h3>
<div class="paragraph">
<p>Notice how simple your <code>getVideo()</code> function is.</p>
</div>
<div class="paragraph">
<p>Run the web application and view the details of a single video.</p>
</div>
<div class="paragraph">
<p>Exercise complete!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SOLUTION-8">Solution 8: Accessors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This exercise is designed to create a custom accessors to pull video data.</p>
</div>
<div class="paragraph">
<p>Checkout the branch for this exercise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">git checkout exercise8</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="step-1">Step 1</h3>
<div class="paragraph">
<p>Navigate to <code>src/main/java/com/datastax/training/killrvideo/model/dao/cassandra/</code>. Add a Java file in this folder called <code>VideoByUserAccessor.java</code>. Within this file, add an interface named <code>VideoByUserAccessor</code> which will act as our accessor to our <code>videos_by_user</code> table.</p>
</div>
<div class="paragraph">
<p>Add a function called</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Result</span>&lt;VideoByUser&gt; getVideosForUser(<span class="predefined-type">UUID</span> userId, <span class="type">int</span> rowLimit)</code></pre>
</div>
</div>
<div class="paragraph">
<p>stub which will act as our accessor function to the database. Be sure to add the appropriate annotations to this function so it will pull the <code>videos_by_user</code> table data appropriately. Use <code>rowLimit</code> in a LIMIT clause within your query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.datastax.training.killrvideo.model.dao.cassandra</span>;

<span class="keyword">import</span> <span class="include">com.datastax.training.killrvideo.model.VideoByUser</span>;
<span class="keyword">import</span> <span class="include">com.datastax.driver.mapping.Result</span>;
<span class="keyword">import</span> <span class="include">com.datastax.driver.mapping.annotations.Accessor</span>;
<span class="keyword">import</span> <span class="include">com.datastax.driver.mapping.annotations.Param</span>;
<span class="keyword">import</span> <span class="include">com.datastax.driver.mapping.annotations.Query</span>;

<span class="keyword">import</span> <span class="include">java.util.UUID</span>;

<span class="annotation">@Accessor</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">VideoByUserAccessor</span> {
    <span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM videos_by_user WHERE user_id = :userId LIMIT :rowLimit</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined-type">Result</span>&lt;VideoByUser&gt; getVideosForUser(<span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">userId</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">UUID</span> userId, <span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">rowLimit</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> rowLimit);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-2">Step 2</h3>
<div class="paragraph">
<p>Navigate to <code>webapp/src/main/java/com/datastax/training/killrvideo/model/dao/cassandra/CassandraVideoDAO.java</code>. Add a <code>private VideoByUserAccessor accessor;</code> field to this class. Within the constructor, set your <code>accessor</code> field to a valid instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">accessor = mapper.getManager().createAccessor(VideoByUserAccessor.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Jump to the <code>getUserVideos()</code> function, and use your <code>accessor</code> instance to return the videos for the user with the given <code>UUID</code>. Pass 12 for your row limit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Iterable</span>&lt;VideoByUser&gt; getUserVideos(<span class="predefined-type">UUID</span> userId) {
    <span class="type">int</span> rowLimit = <span class="integer">12</span>;
    <span class="keyword">return</span> accessor.getVideosForUser(userId, rowLimit);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="step-3">Step 3</h3>
<div class="paragraph">
<p>Navigate to the web page that displays videos for a given user. Notice the videos appear.</p>
</div>
<div class="paragraph">
<p>Exercise complete!</p>
</div>
</div>
<div class="sect2">
<h3 id="addendum">Addendum</h3>

</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-11-09 21:15:20 PST
</div>
</div>
</body>
</html>